#pragma once
#include <string>
#include "fileRead.h"

using namespace std;

class PolyPhaseFilter
{
public:

	/**
	 * \brief 
	 * \param inFile input file containing x[n] data
	 * \param outFile desired output file for y[n]
	 * \param M upsampling rate
	 * \param L downsampling rate
	 */
	PolyPhaseFilter(const string& inFile, const string& outFile, int M, int L) : file(inFile, outFile), upRate(L), downRate(M)
	{

	}

	/**
	 * \brief Performs a sampling conversion on x[n] with the rates M,L given in the constructor
	 */
	void Filter()
	{
		while(!file.eof)
		{
			file.WriteValue(Filter(file.GetValue()));
		}
	}

	/**
	 * \brief Performs the PolyPhase implementation of the sampling conversion L/M.
	 */
	void PolyFilter()
	{
		
	}


private:
	

	FileRead file;
	const int static FILTER_SIZE = 192;
	double xBuff[FILTER_SIZE] = {0};
	int upRate, downRate;


	/**
	 * \brief Shift the given array right by one and put 0 at x[0]
	 * \param x array to shift
	 */
	void ShiftRight(double *x) const
	{
		for (auto i = FILTER_SIZE-1; i > 0; i--)
		{
			x[i] = x[i - 1];
		}
		x[0] = 0.0;
	}

	/**
	 * \brief filters the given x value through a FIR filter. 
	 * This is only the filter, does not up or down sample.
	 * \param x input x'[n] value
	 * \return output y'[n] value
	 */
	float Filter(float x)
	{
		auto y = 0.0;
		// Step 1. Shift xbuff and put x into xbuff[0]
		ShiftRight(xBuff);
		xBuff[0] = x;
		// Step 3. Accumulate filter output into y
		for (auto i = 0; i <= 5; i++)
		{
			y += FIRValues[i] * xBuff[i];
		}

		return static_cast<float>(y);
	}
	/**
	 * \brief Splits the FIR filter into multiple parts to perform Poly Phase Filtering
	 * \param x Input x[n] value
	 * \return 
	 */
	float PolyFilter(float x)
	{
		//TODO implement polyphase filter
		return 0;
	}

	// ReSharper disable once CppInconsistentNaming
	const double FIRValues[FILTER_SIZE] =
	{
		-0.000024934725598981149813273411330882823,
		-0.000065636259920886252960427198477333377,
		 0.00000104115023886531995718843224274508 ,
		 0.00001166009124776822551044011544441048 ,
		 0.00005235268701868843569139852500704535 ,
		 0.00006499893961700543495996207354892249 ,
		 0.00004786185942665241097038197892743483 ,
		-0.000004585331255275336892127113763706348,
		-0.000069917636883125842441055741716127159,
		-0.000114361356739307078937521733319471196,
		-0.000105773666735641501401854469577301643,
		-0.000034694375085410698704175419537776293,
		 0.000074690970215328384004468964540990328,
		 0.000169961812512214893201856202864519219,
		 0.000193775566367677482210521433536598579,
		 0.000115641999386621120086797442905179878,
		-0.000044525704547155667820980406990116762,
		-0.000216252044824462611935511624494665739,
		-0.000307075678294447542652362281856426307,
		-0.000249645413291534404298666061094991164,
		-0.000044522380354490489334784442121417669,
		 0.000226307040306222931888915916864846167,
		 0.000428474397664444211358825143065587326,
		 0.0004389798698596800944488061091419695  ,
		 0.000215740453749411570339919452798937982,
		-0.000164301369932398188666161642501606366,
		-0.000525350865445969395298164705820909148,
		-0.000670445129335216563615240659146365942,
		-0.000484331495295782748881918688965697584,
		-0.000009647993453537354806119619166082657,
		 0.000549417212097166179907148375605174806,
		 0.000909895047412218440155418086590088933,
		 0.000848676037136993164505804898567475902,
		 0.000331145655317334280075269870025067576,
		-0.000440752022116178013635967580796659604,
		-0.001099392938591080542271027908896030567,
		-0.001281336965236933023160048605859628879,
		-0.000820291767161311267085588294634135309,
		 0.000136100068975523644763947483937727156,
		 0.001158680984475529349153610780831513694,
		 0.001722495538229908661198575003936639405,
		 0.001469198887671576986974075751390955702,
		 0.000418141270010441163784004059422727551,
		-0.000992238004106667150633347418420271424,
		-0.002077183186842415478501333581107246573,
		-0.002230335731026906499752104906519889482,
		-0.00125024872686212693874419077388893129 ,
		 0.000502119040231057182054053011910355053,
		 0.00221893871400532030624397350493381964 ,
		 0.003008352809175702732846779952069482533,
		 0.002346477029417571701780387272151529032,
		 0.00039459201699194092769276687171497997 ,
		-0.001999850288267857132545879395024712721,
		-0.003657611339089371881028167621252578101,
		-0.003636425515970850234209743589985919243,
		-0.001745396873668818684202652669057442836,
		 0.001266925760369565397145397156464241561,
		 0.003986570304187041918764222714344214182,
		 0.004983089934750783295269727091181266587,
		 0.003542558277226564959760946038613838027,
		 0.00011774352186552758565973864079978739 ,
		-0.003768296876768313305450242012284434168,
		-0.006178693850695608433265526571176451398,
		-0.005706671689582516922290000849216085044,
		-0.002256737924766483421173957069072457671,
		 0.002754315752981537166604875110920147563,
		 0.006945732038727015986157020677183027146,
		 0.008075999802918627790138117461538058706,
		 0.005202617612172315102181396895275611314,
		-0.000684345737118451612202019163078148267,
		-0.006937461504363227199343455708913097624,
		-0.010401329782365468373805938995246833656,
		-0.008956111966148507658180832891048339661,
		-0.002722062332771000344594503062012336159,
		 0.005722852177638477338961209284207143355,
		 0.012340139889645281023877743109551374801,
		 0.013489364465164677825415040501866315026,
		 0.007824283415129890117967192963988054544,
		-0.002715938011373784065349834548896978959,
		-0.013428967962625533091869378665705880849,
		-0.018823026349476690288753388813347555697,
		-0.015262232182947338410272664077638182789,
		-0.003077326146603465064494065117628451844,
		 0.012959630076950943641800328975932643516,
		 0.025258306327791427148277136893739225343,
		 0.026660957633553441364915315148209629115,
		 0.014032211507926974081161830554265179671,
		-0.009416735171556044406426799753262457671,
		-0.034295575437389078099492678575188620016,
		-0.047953435557098508801310288163222139701,
		-0.039233484590640688161045090964762493968,
		-0.003269816833183256804540306461603904609,
		 0.055650848056172194655566443088900996372,
		 0.124494971998675110769205787164537468925,
		 0.185251215220669396277486384860821999609,
		 0.220809878549311583428860217281908262521,
		 0.220809878549311583428860217281908262521,
		 0.185251215220669396277486384860821999609,
		 0.124494971998675110769205787164537468925,
		 0.055650848056172194655566443088900996372,
		-0.003269816833183256804540306461603904609,
		-0.039233484590640688161045090964762493968,
		-0.047953435557098508801310288163222139701,
		-0.034295575437389078099492678575188620016,
		-0.009416735171556044406426799753262457671,
		 0.014032211507926974081161830554265179671,
		 0.026660957633553441364915315148209629115,
		 0.025258306327791427148277136893739225343,
		 0.012959630076950943641800328975932643516,
		-0.003077326146603465064494065117628451844,
		-0.015262232182947338410272664077638182789,
		-0.018823026349476690288753388813347555697,
		-0.013428967962625533091869378665705880849,
		-0.002715938011373784065349834548896978959,
		 0.007824283415129890117967192963988054544,
		 0.013489364465164677825415040501866315026,
		 0.012340139889645281023877743109551374801,
		 0.005722852177638477338961209284207143355,
		-0.002722062332771000344594503062012336159,
		-0.008956111966148507658180832891048339661,
		-0.010401329782365468373805938995246833656,
		-0.006937461504363227199343455708913097624,
		-0.000684345737118451612202019163078148267,
		 0.005202617612172315102181396895275611314,
		 0.008075999802918627790138117461538058706,
		 0.006945732038727015986157020677183027146,
		 0.002754315752981537166604875110920147563,
		-0.002256737924766483421173957069072457671,
		-0.005706671689582516922290000849216085044,
		-0.006178693850695608433265526571176451398,
		-0.003768296876768313305450242012284434168,
		 0.00011774352186552758565973864079978739 ,
		 0.003542558277226564959760946038613838027,
		 0.004983089934750783295269727091181266587,
		 0.003986570304187041918764222714344214182,
		 0.001266925760369565397145397156464241561,
		-0.001745396873668818684202652669057442836,
		-0.003636425515970850234209743589985919243,
		-0.003657611339089371881028167621252578101,
		-0.001999850288267857132545879395024712721,
		 0.00039459201699194092769276687171497997 ,
		 0.002346477029417571701780387272151529032,
		 0.003008352809175702732846779952069482533,
		 0.00221893871400532030624397350493381964 ,
		 0.000502119040231057182054053011910355053,
		-0.00125024872686212693874419077388893129 ,
		-0.002230335731026906499752104906519889482,
		-0.002077183186842415478501333581107246573,
		-0.000992238004106667150633347418420271424,
		 0.000418141270010441163784004059422727551,
		 0.001469198887671576986974075751390955702,
		 0.001722495538229908661198575003936639405,
		 0.001158680984475529349153610780831513694,
		 0.000136100068975523644763947483937727156,
		-0.000820291767161311267085588294634135309,
		-0.001281336965236933023160048605859628879,
		-0.001099392938591080542271027908896030567,
		-0.000440752022116178013635967580796659604,
		 0.000331145655317334280075269870025067576,
		 0.000848676037136993164505804898567475902,
		 0.000909895047412218440155418086590088933,
		 0.000549417212097166179907148375605174806,
		-0.000009647993453537354806119619166082657,
		-0.000484331495295782748881918688965697584,
		-0.000670445129335216563615240659146365942,
		-0.000525350865445969395298164705820909148,
		-0.000164301369932398188666161642501606366,
		 0.000215740453749411570339919452798937982,
		 0.0004389798698596800944488061091419695  ,
		 0.000428474397664444211358825143065587326,
		 0.000226307040306222931888915916864846167,
		-0.000044522380354490489334784442121417669,
		-0.000249645413291534404298666061094991164,
		-0.000307075678294447542652362281856426307,
		-0.000216252044824462611935511624494665739,
		-0.000044525704547155667820980406990116762,
		 0.000115641999386621120086797442905179878,
		 0.000193775566367677482210521433536598579,
		 0.000169961812512214893201856202864519219,
		 0.000074690970215328384004468964540990328,
		-0.000034694375085410698704175419537776293,
		-0.000105773666735641501401854469577301643,
		-0.000114361356739307078937521733319471196,
		-0.000069917636883125842441055741716127159,
		-0.000004585331255275336892127113763706348,
		 0.00004786185942665241097038197892743483 ,
		 0.00006499893961700543495996207354892249 ,
		 0.00005235268701868843569139852500704535 ,
		 0.00001166009124776822551044011544441048 ,
		 0.00000104115023886531995718843224274508 ,
		-0.000065636259920886252960427198477333377,
		-0.000024934725598981149813273411330882823
	};

};
